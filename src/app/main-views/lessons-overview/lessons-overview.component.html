<div class="caption">
  @if (loggedIn) {
    <span>{{ userName }}</span>
    <span class="link">Odhlásit</span>
    <span class="link" (click)="openUserDialog($event, LOG_DIALOG_MODE.Edit)">Editovat</span>
  } @else {
    <span class="link">Demo</span>
    <span class="link" (click)="openUserDialog($event, LOG_DIALOG_MODE.LogIn)">Přihlásit</span>
    <span class="link" (click)="openUserDialog($event, LOG_DIALOG_MODE.New)">Registrovat</span>
  }
  <p-popover #logDialogPopOver>
    <log-dialog (dialogOutput)="dialogOutput($event); logDialogPopOver.toggle($event) " [mode]="logDialogMode"
                [userId]="userId"
    ></log-dialog>
  </p-popover>
</div>

<p-table
  #lessonTable
  [sortField]="'status'"
  [sortOrder]="-1"
  [value]="lessons"
>

  <ng-template #caption>
    <toggler></toggler>
    <p-button (click)="openDialog('New')">Nová lekce</p-button>
  </ng-template>

  <ng-template pTemplate="colgroup">
    <colgroup>
      <col style="width: 12%;">
      <col style="width: 40%; min-width: 110px">
      <col style="width: 12%;">
      <col style="width: 12%;">
      <col style="width: 12%;">
      <col style="width: 12%;">
    </colgroup>
  </ng-template>

  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="status">
        Status
        <p-sortIcon field="status"/>
        <filter [clearAllFilters]="clearAllFilters$" [fieldName]="'status'" [table]="lessonTable"/>
      </th>
      <th pSortableColumn="lessonName">
        Název
        <p-sortIcon field="lessonName"/>
        <filter [clearAllFilters]="clearAllFilters$" [fieldName]="'lessonName'" [table]="lessonTable"/>
      </th>
      <th class="hide-sm hide-md" pSortableColumn="category">
        Kategorie
        <p-sortIcon field="category"/>
        <filter [clearAllFilters]="clearAllFilters$" [fieldName]="'category'" [table]="lessonTable"/>
      </th>
      <th class="hide-sm hide-md" pSortableColumn="wordCount">
        Slovíček
        <p-sortIcon field="wordCount"/>
        <filter [clearAllFilters]="clearAllFilters$" [fieldName]="'wordCount'" [table]="lessonTable"/>
      </th>
      <th class="hide-sm" pSortableColumn="score">
        Score
        <p-sortIcon field="score"/>
        <filter [clearAllFilters]="clearAllFilters$" [fieldName]="'score'" [table]="lessonTable"/>
      </th>
      <th>
        <i (click)="clearAllFilters(lessonTable)" class="pi pi-filter-slash"></i>
      </th>
    </tr>
  </ng-template>

  <ng-template let-row pTemplate="body">
    <tr [pTooltip]="row.description" tooltipPosition="top">
      @if (row.status == 'own') {
        <td (click)="practiceLesson(row)"><i class="pi pi-play small-icon"></i></td>
      } @else {
        <td (click)="copyLesson(row.id)" class="not-own"><i class="pi pi-copy  small-icon"></i></td>
      }
      <td (click)="toDetail(row)">{{ row.lessonName }}</td>
      <td (click)="toDetail(row)" class="hide-sm hide-md">{{ row.category }}</td>
      <td (click)="toDetail(row)" class="hide-sm hide-md">{{ row.wordCount }}</td>
      <td class="hide-sm">{{ row.status === 'own' ? row.score : null }}</td>
      <td>
        @if (row.status === 'own') {
          <actions-popover (actionSelected)="lessonActionSelected($event, row)"></actions-popover>
        }
      </td>
    </tr>
  </ng-template>
</p-table>
<action-dialog #actionDialog (dataToSave)="saveLessonChanges($event)"></action-dialog>
<confirm-action-dialog #confirmDialog (confirmOutput)="confirmDeletion($event)"></confirm-action-dialog>
